stages:
  - staging
  - production

default:
  before_script:
    - export PATH="$PATH:/Users/sonny/Documents/flutter/bin"
    - dart pub global activate melos
    - export PATH="$PATH":"$HOME/.pub-cache/bin"
    - flutter pub get
    - dart pub global activate melos
    - export PATH="$PATH":"$HOME/.pub-cache/bin"
    - flutter pub get

variables:
  LC_ALL: "en_US.UTF-8"
  LANG: "en_US.UTF-8"

Deploy To Android Private Beta:
  stage: staging
  tags:
    - shell
  script:
    - melos bs
    - cd packages/client
    - echo "LEOPARD_MODEL_PATH=assets/leopard_model.pv" >> .env
    - echo "AGORA_APP_ID=$AGORA_APP_ID" >> .env
    - echo "LEOPARD_ACCESS_KEY=$LEOPARD_ACCESS_KEY" >> .env
    - echo "PROD_SUPABASE_URL=$STAGING_SUPABASE_URL" >> .env
    - echo "PROD_SUPABASE_ANON_KEY=$STAGING_SUPABASE_ANON_KEY" >> .env
    - chmod u+x ./_scripts/android/*.sh
    - ./_scripts/android/build_android.sh
    - ./_scripts/android/distribute_android_staging.sh
  only:
    - staging
  when: manual

External Android Beta Build:
  stage: production
  tags:
    - shell
  script:
    - melos bs
    - cd packages/client
    - echo "AGORA_APP_ID=$AGORA_APP_ID" >> .env
    - echo "LEOPARD_MODEL_PATH=assets/leopard_model.pv" >> .env
    - echo "LEOPARD_ACCESS_KEY=$LEOPARD_ACCESS_KEY" >> .env
    - echo "PROD_SUPABASE_URL=$PROD_SUPABASE_URL" >> .env
    - echo "PROD_SUPABASE_ANON_KEY=$PROD_SUPABASE_ANON_KEY" >> .env
    - chmod u+x ./_scripts/android/*.sh
    - ./_scripts/android/build_android.sh
    - ./_scripts/android/distribute_android_production.sh
  only:
    - staging
  when: manual
